<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <title>TECHFIT - EjecuciÃ³n</title>

    <!-- CSS -->
    <link rel="stylesheet" href="/css/header.css">
    <link rel="stylesheet" href="/css/General/ejecucion.css">
</head>

<body>

<!-- NAVBAR -->
<nav class="navbar">
    <button class="back-btn" onclick="window.location.href='/pages/Catalogos/catalogo.html'">â†</button>

    <h1 class="header-title">
        Ejecutando ejercicio â€” <span id="nombre-ejercicio"></span>
    </h1>

    <img id="perfilMini" class="perfil-mini" src="/img/user_default.png"
         onclick="window.location.href='/pages/perfil.html'">
</nav>

<main class="exec-container">

    <!-- CÃMARA -->
    <section class="camera-card">
        
        <div class="camera-status" id="cameraStatus">CÃ¡mara: Activa â€¢ Temporizador: Activo</div>

        <div class="camera-wrapper">
            <video id="video" autoplay playsinline></video>
            <canvas id="poseCanvas"></canvas>
        </div>

        <!-- HUD -->
        <div class="hud">
            <div class="hud-item">Reps: <span id="hud-reps">0</span></div>
            <div class="hud-item">Score: <span id="hud-score">0</span></div>
            <div class="hud-item">Nivel: <span id="hud-level">1</span></div>
        </div>

        <!-- LUCES -->
        <div class="lights">
            <div id="light-ok" class="light ok"></="light">
            <div id="light-bad" class="light bad"></div>
        </div>

        <!-- FEEDBACK -->
        <p id="feedback" class="feedback">Preparado para comenzar...</p>

        <!-- HIIT TIMER -->
        <div class="hiit-timer">
            <h2 id="hiit-label">HIIT: Ejercicio</h2>
            <span id="hiit-time">30</span>s
            <div id="timer-status" style="font-size: 12px; margin-top: 5px;">Activo</div>
        </div>

    </section>

    <!-- CONTROLES -->
    <section class="controls-card">

        <h2>Controles</h2>

        <button id="btnPausar">â¸ Pausar</button>
        <button id="btnReanudar">â–¶ Reanudar</button>
        <button id="btnDetener">â¹ Finalizar</button>
        <button id="voiceHelpBtn" class="voice-btn">ğŸ¤ Comandos</button>

        <div id="voiceCommandsPanel" class="voice-panel">
            <h3>Comandos disponibles:</h3>
            <ul>
                <li>â€œPausarâ€ / â€œPausaâ€ / â€œPararâ€</li>
                <li>â€œSeguirâ€ / â€œContinuarâ€ / â€œReanudarâ€</li>
                <li>â€œDetenerâ€</li>
                <li>â€œTiempoâ€</li>
                <li>â€œSalirâ€</li>
                <li>Modos: â€œModo intensoâ€, â€œModo recuperativoâ€, â€œModo nocturnoâ€, â€œModo silenciosoâ€, â€œModo normalâ€, â€œModo powerâ€</li>
            </ul>
        </div>

    </section>

</main>

<!-- JS MEDIAPIPE -->
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/holistic/holistic.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js"></script>

<script>
    // Cargar el nombre del ejercicio y la foto de perfil
    document.addEventListener('DOMContentLoaded', function() {
        const params = new URLSearchParams(window.location.search);
        const ejercicio = params.get("ejercicio");
        if (ejercicio) {
            document.getElementById("nombre-ejercicio").textContent = ejercicio;
        }
        
        // Cargar foto de perfil
        let mini = localStorage.getItem("fotoPerfil");
        if (mini) document.getElementById("perfilMini").src = mini;
    });
</script>

<!-- LÃ“GICA DE CÃMARA + DETECTOR -->
<script src="/js/camara.js"></script>

<!-- VOZ DE EJECUCIÃ“N -->
<script src="/js/voice/voice-ejecucion.js"></script>

<!-- MODAL DE SALIDA -->
<div id="exitModal" class="exit-modal hidden">
    <div class="exit-modal-content">
        <h3>Â¿Deseas continuar o salir?</h3>

        <div class="modal-buttons">
            <button id="seguirBtn">Seguir</button>
            <button id="salirBtn" class="danger">Salir</button>
        </div>
    </div>
</div>

</body>
</html>
